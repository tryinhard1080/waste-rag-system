<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Warehouse Dashboard | RAG Intelligence</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="header-content">
            <h1><span class="icon">ðŸ“§</span> Email Warehouse</h1>
            <div class="header-stats">
                <div class="stat">
                    <div class="stat-value" id="totalEmails">0</div>
                    <div class="stat-label">Total Emails</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="dateRange">-</div>
                    <div class="stat-label">Date Range</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="uniqueSenders">0</div>
                    <div class="stat-label">Contacts</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav>
        <div class="nav-content">
            <button class="nav-btn active" data-view="overview">Overview</button>
            <button class="nav-btn" data-view="kpis">KPIs</button>
            <button class="nav-btn" data-view="analytics">Analytics</button>
            <button class="nav-btn" data-view="rag">AI Query</button>
            <button class="nav-btn" data-view="search">Search</button>
            <button class="nav-btn" data-view="timeline">Timeline</button>
        </div>
    </nav>

    <!-- Main Content -->
    <main>
        <!-- Overview View -->
        <div id="view-overview" class="view">
            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-value" id="stat-total">1,182</div>
                    <div class="stat-card-label">Total Emails</div>
                    <div class="stat-card-change positive">â†‘ 3.2% this week</div>
                </div>
                <div class="stat-card secondary">
                    <div class="stat-card-value" id="stat-received">742</div>
                    <div class="stat-card-label">Received</div>
                    <div class="stat-card-change positive">â†‘ 2.8% this week</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-value" id="stat-sent">440</div>
                    <div class="stat-card-label">Sent</div>
                    <div class="stat-card-change positive">â†‘ 4.1% this week</div>
                </div>
                <div class="stat-card warning">
                    <div class="stat-card-value" id="stat-threads">215</div>
                    <div class="stat-card-label">Active Threads</div>
                    <div class="stat-card-change negative">â†“ 1.5% this week</div>
                </div>
            </div>

            <!-- Charts -->
            <div class="grid grid-2">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Email Volume Over Time</h2>
                    </div>
                    <div class="chart-container">
                        <canvas id="volumeChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Email Type Distribution</h2>
                    </div>
                    <div class="chart-container">
                        <canvas id="typeChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Recent Emails</h2>
                    <div class="card-actions">
                        <button class="btn btn-secondary btn-sm" id="refreshBtn">Refresh</button>
                    </div>
                </div>
                <div id="recentEmails" class="email-list"></div>
            </div>
        </div>

        <!-- KPIs View -->
        <div id="view-kpis" class="view hidden">
            <!-- KPI Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-value" id="kpi-cpd">$-</div>
                    <div class="stat-card-label">Avg Cost/Door</div>
                    <div class="stat-card-change" id="kpi-cpd-trend">-</div>
                </div>
                <div class="stat-card secondary">
                    <div class="stat-card-value" id="kpi-ypd">-</div>
                    <div class="stat-card-label">Avg Yards/Door</div>
                    <div class="stat-card-change" id="kpi-ypd-trend">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-value" id="kpi-properties">-</div>
                    <div class="stat-card-label">Properties</div>
                    <div class="stat-card-change">Tracked</div>
                </div>
                <div class="stat-card warning">
                    <div class="stat-card-value" id="kpi-rates">-</div>
                    <div class="stat-card-label">Rate Records</div>
                    <div class="stat-card-change">In Database</div>
                </div>
            </div>

            <!-- Rate Benchmarks -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Rate Benchmarks</h2>
                    <div class="card-actions">
                        <select id="benchmarkVendor" class="filter-select">
                            <option value="">All Vendors</option>
                            <option value="WM">Waste Management</option>
                            <option value="Republic">Republic Services</option>
                            <option value="Waste Connections">Waste Connections</option>
                        </select>
                        <select id="benchmarkService" class="filter-select">
                            <option value="compactor">Compactor</option>
                            <option value="dumpster">Dumpster</option>
                            <option value="recycling">Recycling</option>
                        </select>
                        <button class="btn btn-secondary btn-sm" id="refreshBenchmarks">Refresh</button>
                    </div>
                </div>
                <div id="rateBenchmarks" class="benchmarks-grid">
                    <div class="loading">Loading rate benchmarks...</div>
                </div>
            </div>

            <!-- Charts -->
            <div class="grid grid-2">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Cost/Door Trend</h2>
                    </div>
                    <div class="chart-container">
                        <canvas id="cpdChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Rate Pricing Trends</h2>
                    </div>
                    <div class="chart-container">
                        <canvas id="rateChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Property KPIs Table -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Property KPIs</h2>
                </div>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Property</th>
                            <th>Type</th>
                            <th>Units</th>
                            <th>Cost/Door</th>
                            <th>Yards/Door</th>
                            <th>Total Cost</th>
                        </tr>
                    </thead>
                    <tbody id="propertyKPITable">
                        <tr><td colspan="6" class="loading">Loading property data...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Analytics View -->
        <div id="view-analytics" class="view hidden">
            <div class="grid grid-2">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Top Senders</h2>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Sender</th>
                                <th>Emails</th>
                                <th>%</th>
                            </tr>
                        </thead>
                        <tbody id="topSendersTable"></tbody>
                    </table>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Top Recipients</h2>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Recipient</th>
                                <th>Emails</th>
                                <th>%</th>
                            </tr>
                        </thead>
                        <tbody id="topRecipientsTable"></tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Vendor Analysis</h2>
                </div>
                <div id="vendorAnalysis">
                    <div class="loading">Loading vendor data...</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Property Communications</h2>
                </div>
                <div id="propertyAnalysis">
                    <div class="loading">Loading property data...</div>
                </div>
            </div>
        </div>

        <!-- RAG Query View -->
        <div id="view-rag" class="view hidden">
            <div class="rag-query">
                <h3>ðŸ¤– Ask Your Email Knowledge Base</h3>
                <p style="margin-bottom: 1rem; opacity: 0.9;">Query your email history using natural language. Powered by Gemini RAG.</p>
                <div class="rag-input-group">
                    <input
                        type="text"
                        id="ragQueryInput"
                        class="rag-input"
                        placeholder="e.g., What contamination issues have we dealt with?"
                    >
                    <button class="btn btn-secondary" id="ragQueryBtn">Ask AI</button>
                </div>
                <div id="ragResults" class="rag-results hidden">
                    <div id="ragAnswer"></div>
                </div>
                <div id="ragLoading" class="rag-loading hidden">
                    <div class="spinner"></div>
                    <p style="margin-top: 1rem;">Searching 1,182 emails...</p>
                </div>
            </div>

            <!-- Example Questions -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Example Questions</h2>
                </div>
                <div class="grid grid-3">
                    <button class="btn btn-secondary example-question">What vendors do I communicate with most?</button>
                    <button class="btn btn-secondary example-question">What contamination issues have been reported?</button>
                    <button class="btn btn-secondary example-question">Show me all emails about Jones Grant property</button>
                    <button class="btn btn-secondary example-question">What are common invoice disputes?</button>
                    <button class="btn btn-secondary example-question">How did we resolve Republic Services issues?</button>
                    <button class="btn btn-secondary example-question">What's our history with Waste Management?</button>
                </div>
            </div>

            <!-- Query History -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Recent Queries</h2>
                </div>
                <div id="queryHistory" class="timeline">
                    <div class="loading">No queries yet</div>
                </div>
            </div>
        </div>

        <!-- Search View -->
        <div id="view-search" class="view hidden">
            <div class="search-section">
                <div class="search-bar">
                    <input
                        type="text"
                        id="searchInput"
                        class="search-input"
                        placeholder="Search emails by subject, sender, content..."
                    >
                    <button class="btn btn-primary" id="searchBtn">Search</button>
                </div>
                <div class="filters">
                    <div class="filter-group">
                        <label class="filter-label">Date Range</label>
                        <select id="searchDateRange" class="filter-select">
                            <option value="all">All Time</option>
                            <option value="7">Last 7 days</option>
                            <option value="30">Last 30 days</option>
                            <option value="90">Last 90 days</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Type</label>
                        <select id="searchType" class="filter-select">
                            <option value="all">All Types</option>
                            <option value="received">Received</option>
                            <option value="sent">Sent</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Sender</label>
                        <select id="searchSender" class="filter-select">
                            <option value="all">All Senders</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Search Results</h2>
                    <div id="searchCount" class="stat-label"></div>
                </div>
                <div id="searchResults" class="email-list">
                    <div class="loading">Enter a search query to begin</div>
                </div>
            </div>
        </div>

        <!-- Timeline View -->
        <div id="view-timeline" class="view hidden">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Email Timeline</h2>
                    <div class="card-actions">
                        <select id="timelineGranularity" class="filter-select">
                            <option value="day">Daily</option>
                            <option value="week" selected>Weekly</option>
                            <option value="month">Monthly</option>
                        </select>
                    </div>
                </div>
                <div class="chart-container" style="height: 400px;">
                    <canvas id="timelineChart"></canvas>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Activity by Day of Week</h2>
                </div>
                <div class="chart-container">
                    <canvas id="dayOfWeekChart"></canvas>
                </div>
            </div>
        </div>
    </main>

    <!-- Email Detail Modal -->
    <div id="emailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Email Details</h3>
                <button class="modal-close" id="closeModal">Ã—</button>
            </div>
            <div class="modal-body" id="emailDetail"></div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
